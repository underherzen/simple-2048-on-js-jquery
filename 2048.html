<body>
<div class='app'></div>
Score: <input disabled=true id = 'kok' value='0'></input>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
<script>
$(document).ready(function() {
	mas = [[0,0,0,0],
		   [0,0,0,0],
		   [0,0,0,0],
		   [0,0,0,0]]
	function randomInteger(min,max) {
		var rand = min + Math.random() * (max + 1 - min);
		rand = Math.floor(rand);
		return rand;
	 }
	function comparing(mas1,mas2){
	checks = 0;
		for(var i=0;i<4;i++) {
			if(mas1[i].toString() != mas2[i].toString()) { checks = 1; console.log('WWWW');}
		
		}
	return checks;
	}
	function Left(mas) {
	masWork = mas;
	mascock = mas;
	checking = 0;
		for(var i = 0; i<4;i++) {
			
			for(var check=0;check<3;check++) {
		
			while(masWork[i][check] == 0 && masWork[i][check]<masWork[i][check+1]){
				masWork[i].splice(check,1);
				masWork[i][3] = 0;
				check = 0;
				checking = 1;
			}
			}
			for(var j = 0;j<3;j++) {
			
	
				if(masWork[i][j] == masWork[i][j+1] && masWork[i][j]>0) {
					masWork[i][j] *= 2;
					score = $('#kok').val();
					console.log(score);
					score = parseInt(score);
					score+=masWork[i][j]
					$('#kok').val(score);
					console.log(score);
					masWork[i].splice(j+1,1);
					console.log(masWork[i]);
					masWork[i][3] = 0;
					checking = 1;
					
				}
				if(masWork[i][j] == 0) {
					masWork[i].splice(j,1);
					masWork[i][3] = 0;
					//checking = 1;
				}
				
				
			
			}
			for(var k = 0; k<3; k++) {
			while(masWork[i][k] == 0 && masWork[i][k+1]>0) {
			k = 0;
				
				masWork[i].splice(k,1);
				masWork[i][3] = 0;
				//checking = 1;
				}
			}
		}
		for(var i =0;i<4;i++) {
	
		str = '';
		
		for(var j =0; j<4; j++) {
			backgroundcol = '';
			str = str + masWork[i][j] + ' ';
		}
	
		console.log(str);
	}
	//checking = comparing(mascock,masWork);
	if(checking == 1) { masWork = AddRandom(masWork);}
	
		return masWork;
	}
	
	function reverseleft(mas) {
		masWork = mas;
		mascock = mas;
		checking = 0;
			for(var i = 0; i<4;i++) {
			check = 0;
			masWork[i].reverse();
			for(var check=0;check<3;check++) {
			while(masWork[i][check] == 0 && masWork[i][check]<masWork[i][check+1]){
				masWork[i].splice(check,1);
				masWork[i][3] = 0;
				check = 0;
				checking = 1;
			}
			}
			for(var j = 0;j<3;j++) {
				
				console.log('SLED ITER');
				if(masWork[i][j] == masWork[i][j+1] && masWork[i][j]>0) {
					masWork[i][j] *= 2;
					score = $('#kok').val();
					score = parseInt(score);
					score+=masWork[i][j]
					$('#kok').val(score);
					masWork[i].splice(j+1,1);
					console.log(masWork[i]);
					masWork[i][3] = 0;
					checking = 1;
					
				}
				if(masWork[i][j] == 0) {
					masWork[i].splice(j,1);
					masWork[i][3] = 0;
					//checking = 1;
				}
				
			
			}
			
			for(var k = 0; k<3; k++) {
			while(masWork[i][k] == 0 && masWork[i][k+1]>0) {
			k = 0;
				
				masWork[i].splice(k,1);
				masWork[i][3] = 0;
				//checking = 1;
				}
			}
			masWork[i].reverse();
		}
		for(var i =0;i<4;i++) {
	
		str = '';
		
		for(var j =0; j<4; j++) {
			backgroundcol = '';
			str = str + masWork[i][j] + ' ';
		}
	
		console.log(str);
	}
	//checking = comparing(mascock,masWork);
	if(checking == 1) { masWork = AddRandom(masWork);}
		return masWork;
	
	}
	function reversedown(mas) {
		masWork = mas;
		mascock = mas;
		checking = 0;
		function TransMatrix(b)       //На входе двумерный массив
{
    for (var d = b.length, a = 0; a < d; a++)
	for (var c = a + 1; c < d; c++) {
var e = b[a][c];
 b[a][c] = b[c][a];
b[c][a] = e
}
return b

}
	masWork = TransMatrix(mas);
	
		for(var i = 0; i<4;i++) {
			
			for(var check=0;check<3;check++) {
			while(masWork[i][check] == 0 && masWork[i][check]<masWork[i][check+1]){
				masWork[i].splice(check,1);
				masWork[i][3] = 0;
				check = 0;
				checking = 1;
			}
			}
			for(var j = 0;j<3;j++) {
			
	
				if(masWork[i][j] == masWork[i][j+1] && masWork[i][j]>0) {
					masWork[i][j] *= 2;
					score = $('#kok').val();
					score = parseInt(score);
					score+=masWork[i][j]
					$('#kok').val(score);
					masWork[i].splice(j+1,1);
					console.log(masWork[i]);
					masWork[i][3] = 0;
					checking = 1;
					
				}
				if(masWork[i][j] == 0) {
					masWork[i].splice(j,1);
					masWork[i][3] = 0;
					//checking = 1;
				}
				
				
			
			}
			for(var k = 0; k<3; k++) {
			while(masWork[i][k] == 0 && masWork[i][k+1]>0) {
			k = 0;
				
				masWork[i].splice(k,1);
				masWork[i][3] = 0;
				//checking = 1;
				}
			}
		}
	

	masWork = TransMatrix(mas);
	for(var i =0;i<4;i++) {
	
		str = '';
		
		for(var j =0; j<4; j++) {
			backgroundcol = '';
			str = str + masWork[i][j] + ' ';
		}
	
		//console.log(str);
	}
	//checking = comparing(mascock,masWork);
	if(checking == 1) { masWork = AddRandom(masWork);}
		return masWork;
	}
		function down(mas) {
		mascock = mas;
		masWork = mas;
		checking = 0;
		function TransMatrix(b)       //На входе двумерный массив
{
    for (var d = b.length, a = 0; a < d; a++)
	for (var c = a + 1; c < d; c++) {
var e = b[a][c];
 b[a][c] = b[c][a];
b[c][a] = e
}
return b

}
	masWork = TransMatrix(mas);
	
		for(var i = 0; i<4;i++) {
			masWork[i].reverse();
			for(var check=0;check<3;check++) {
			while(masWork[i][check] == 0 && masWork[i][check]<masWork[i][check+1]){
				masWork[i].splice(check,1);
				masWork[i][3] = 0;
				check = 0;
				checking = 1;
			}
			}
			for(var j = 0;j<3;j++) {
			
	
				if(masWork[i][j] == masWork[i][j+1] && masWork[i][j]>0) {
					masWork[i][j] *= 2;
					score = $('#kok').val();
					score = parseInt(score);
					score+=masWork[i][j]
					$('#kok').val(score);
					masWork[i].splice(j+1,1);
					console.log(masWork[i]);
					masWork[i][3] = 0;
					checking = 1;
					
				}
				if(masWork[i][j] == 0) {
					masWork[i].splice(j,1);
					masWork[i][3] = 0;
					//checking = 1;
				}
				
				
			
			}
			for(var k = 0; k<3; k++) {
			while(masWork[i][k] == 0 && masWork[i][k+1]>0) {
			k = 0;
				
				masWork[i].splice(k,1);
				masWork[i][3] = 0;
				//checking = 1;
				}
			}
			masWork[i].reverse();
		}
	

	masWork = TransMatrix(masWork);
	for(var i =0;i<4;i++) {
	
		str = '';
		
		for(var j =0; j<4; j++) {
			backgroundcol = '';
			str = str + masWork[i][j] + ' ';
		}
	
		//console.log(str);
	}
	//checking = comparing(mascock,masWork);
	if(checking == 1) { masWork = AddRandom(masWork);}
		return masWork;
	}
	function AddRandom(mas) {
	first_x = randomInteger(0,3);
	first_y = randomInteger(0,3);
	while(mas[first_x][first_y]>0 ){
		first_x = randomInteger(0,3);
		first_y = randomInteger(0,3);
		}
	mas[first_x][first_y] = randomInteger(1,2)*2;
	
	return mas;
	}
	function getRandomColor() {
    var letters = '0123456789ABCDEF';
    var color = '#';
    for (var i = 0; i < 6; i++ ) {
        color += letters[Math.floor(Math.random() * 16)];
    }
    return color;
	}
	
	first_x = randomInteger(0,3);
	first_y = randomInteger(0,3);
	second_x = randomInteger(0,3);
	second_y = randomInteger(0,3);
	while((first_x==second_x) && (first_y == second_y)) {
		second_x = randomInteger(0,3);
		second_y = randomInteger(0,3);
	}
	first = randomInteger(1,2)*2;
	second = randomInteger(1,2)*2;
	mas[first_x][first_y] = first;
	mas[second_x][second_y] = second;
	str = '';
	randomcolor = getRandomColor();
	randcol = randomcolor;
	console.log(randomcolor);
	function paint() {
		$('.box').remove();
		$('.box').empty();
		
		$('.app').empty();
		for(var i =0;i<4;i++) {
	
		str = '';
		
		for(var j =0; j<4; j++) {
			backgroundcol = '';
			str = str + mas[i][j] + ' ';
			if(mas[i][j]>0) {
				switch(mas[i][j]) {
				case 0: randomcolor = 'orange'; break;
				//case 4: randomcolor = 'red'; break;
				case 8: randomcolor = 'yellow'; break;
				case 16: randomcolor = 'green'; break;
				case 32: randomcolor = 'blue'; break;
				case 64: randomcolor = 'orange'; break;
				case 128: randomcolor = 'red'; break;
				case 256: randomcolor = 'red'; break;
				case 512: randomcolor = 'red'; break;
				case 1024: randomcolor = 'red'; break;
				case 2048: randomcolor = 'red'; break;
				default: randomcolor = randcol;
				}
				backgroundcol = 'style = "background-color:'+ randomcolor + '"'
				$('.app').append("<div class = 'box'" + backgroundcol + ">" + mas[i][j] + "</div>");
			}
			else {
			$('.app').append("<div class = 'box'" + backgroundcol + "></div>");}
		}
		$('.app').append("</br>");
		//console.log(str);
	}
	
	}
	for(var i =0;i<4;i++) {
	
		str = '';
		
		for(var j =0; j<4; j++) {
			backgroundcol = '';
			str = str + mas[i][j] + ' ';
			if(mas[i][j]>0) {
				backgroundcol = 'style = "background-color:'+ randomcolor + '"'
				$('.app').append("<div class = 'box'" + backgroundcol + ">" + mas[i][j] + "</div>");
			} else {
			$('.app').append("<div class = 'box'" + backgroundcol + "></div>"); }
		}
		$('.app').append("</br>");
		//console.log(str);
	}
	$(document).keyup(function(event) {
		console.log(event.which);
		mas2 = mas;
		window.setTimeout(function(){
                 // do whatever you want to do     
                  }, 10);
		switch(event.which) {
		case 37:mas = Left(mas);  paint(); break;
		case 38:mas = reversedown(mas);paint(); break;
		case 39:mas = reverseleft(mas);paint(); break;
		case 40:mas = down(mas); paint(); console.log($('.kek').val()); break;
		default: console.log('WRONG');
		
		}
	})
	
	
})
</script>
<style>
	.kek {
		display: inline-block;
		}
	.box {
		width:80px;
		height:80px;
		border-radius:5px;
		background-color:orange;
		text-align:center;
		margin:3px;
		display: inline-block;
		vertical-align:middle;
		font-size:30px;
	
	}
	.app {
	
	}
</style>
</body>